# é”™é¢˜ä¸Šä¼ è‡ªåŠ¨åˆ†ç±»åŠŸèƒ½æ›´æ–°

## ğŸ“… æ›´æ–°æ—¥æœŸ
2024å¹´

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

**ç”¨æˆ·é—®é¢˜**ï¼š
> "è¿˜æœ‰é”™é¢˜ä¸Šä¼ æ¨¡å—ä¹Ÿæ˜¯ï¼Œæœ‰å¯èƒ½æ˜¯è¯­æ³•é¢˜ï¼Œæœ‰å¯èƒ½æ˜¯è¯è½¬é¢˜ï¼Œä¼šè‡ªåŠ¨è¯†åˆ«ç„¶ååˆ†ç±»æ”¶é›†å…¥å¯¹åº”çš„æ•°æ®åº“ä¹ˆï¼Ÿ"

**ç­”æ¡ˆ**ï¼šâœ… **ä¼šï¼** é”™é¢˜ä¸Šä¼ APIå·²æ”¯æŒè‡ªåŠ¨è¯†åˆ«é¢˜å‹å¹¶åˆ†ç±»åˆ°å¯¹åº”çš„æ•°æ®åº“ã€‚

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### æ”¯æŒçš„é¢˜å‹è¯†åˆ«

| é¢˜å‹ | è¯†åˆ«ç‰¹å¾ | åˆ†é…åˆ°æ•°æ®åº“è¡¨ |
|-----|---------|---------------|
| **è¯­æ³•é¢˜** | AIè¯†åˆ«ä¸º `grammar` | `grammarMistakes` |
| **è¯è½¬ç»ƒä¹ ** | AIè¯†åˆ«ä¸º `word-formation` | `transformationMistakes` |
| **é˜…è¯»ç†è§£** | AIè¯†åˆ«ä¸º `reading` | `user_mistakes` |

### å·¥ä½œæµç¨‹

```
ç”¨æˆ·ä¸Šä¼ é”™é¢˜ï¼ˆå›¾ç‰‡/PDFï¼‰
  â†“
AIæ™ºèƒ½è¯†åˆ«é¢˜å‹
  â†“
è‡ªåŠ¨åˆ†ç±»ä¿å­˜
  â†“
â”œâ”€ è¯­æ³•é¢˜ â†’ grammarMistakes è¡¨
â”œâ”€ è¯è½¬ç»ƒä¹  â†’ transformationMistakes è¡¨
â””â”€ é˜…è¯»ç†è§£ â†’ user_mistakes è¡¨
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè¯­æ³•é¢˜

**ä¸Šä¼ å†…å®¹**ï¼š
```
He _____ to school every day.
A. go
B. goes
C. going
D. went
```

**AIè¯†åˆ«ç»“æœ**ï¼š
```json
{
  "category": "grammar",
  "knowledgePoint": "ä¸€èˆ¬ç°åœ¨æ—¶",
  "correctAnswer": "B",
  "explanation": "ä¸€èˆ¬ç°åœ¨æ—¶ï¼Œç¬¬ä¸‰äººç§°å•æ•°å½¢å¼"
}
```

**è‡ªåŠ¨åˆ†ç±»**ï¼š
```
âœ… ä¿å­˜åˆ° grammarMistakes è¡¨
â”œâ”€ userId: ç”¨æˆ·ID
â”œâ”€ grammarPointId: ä¸€èˆ¬ç°åœ¨æ—¶çŸ¥è¯†ç‚¹ID
â”œâ”€ question: é¢˜ç›®å†…å®¹
â”œâ”€ correctAnswer: B
â””â”€ explanation: è§£æè¯´æ˜
```

### ç¤ºä¾‹2ï¼šè¯è½¬ç»ƒä¹ 

**ä¸Šä¼ å†…å®¹**ï¼š
```
The weather is getting _____ (warm).
```

**AIè¯†åˆ«ç»“æœ**ï¼š
```json
{
  "category": "word-formation",
  "correctAnswer": "warmer",
  "explanation": "æ¯”è¾ƒçº§ï¼ŒåŠ -er"
}
```

**è‡ªåŠ¨åˆ†ç±»**ï¼š
```
âœ… ä¿å­˜åˆ° transformationMistakes è¡¨
â”œâ”€ userId: ç”¨æˆ·ID
â”œâ”€ word: warm
â”œâ”€ type: unknownï¼ˆéœ€åç»­ä¼˜åŒ–ï¼‰
â”œâ”€ sentence: é¢˜ç›®å†…å®¹
â””â”€ correctAnswer: warmer
```

### ç¤ºä¾‹3ï¼šé˜…è¯»ç†è§£

**ä¸Šä¼ å†…å®¹**ï¼š
```
Many people like to travel...

Why do many people like to travel?
A. To meet new people
B. To learn about different cultures
C. All of the above
```

**AIè¯†åˆ«ç»“æœ**ï¼š
```json
{
  "category": "reading",
  "knowledgePoint": "é˜…è¯»ç†è§£",
  "correctAnswer": "C"
}
```

**è‡ªåŠ¨åˆ†ç±»**ï¼š
```
âœ… ä¿å­˜åˆ° user_mistakes è¡¨
â”œâ”€ userId: ç”¨æˆ·ID
â”œâ”€ question: é¢˜ç›®å†…å®¹
â”œâ”€ category: reading
â””â”€ correctAnswer: C
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¿®æ”¹çš„æ–‡ä»¶

**æ–‡ä»¶**ï¼š`src/app/api/mistakes/upload/route.ts`

**ä¸»è¦æ”¹åŠ¨**ï¼š

1. **å¯¼å…¥å¿…è¦çš„æ•°æ®åº“è¡¨**
```typescript
import { grammarMistakes, grammarPoints, transformationMistakes, wordTransformations } from '@/storage/database/shared/schema';
```

2. **æ ¹æ®é¢˜å‹è‡ªåŠ¨åˆ†ç±»**
```typescript
const category = question.category || 'reading';

if (category === 'grammar') {
  // è¯­æ³•é¢˜ â†’ ä¿å­˜åˆ° grammarMistakes
  return await saveGrammarMistake(currentUser.userId, question);
} else if (category === 'word-formation') {
  // è¯è½¬ç»ƒä¹  â†’ ä¿å­˜åˆ° transformationMistakes
  return await saveTransformationMistake(currentUser.userId, question);
} else {
  // é˜…è¯»ç†è§£ â†’ ä¿å­˜åˆ° user_mistakes
  return await saveGeneralMistake(currentUser.userId, question);
}
```

3. **æ–°å¢è¾…åŠ©å‡½æ•°**

| å‡½æ•° | åŠŸèƒ½ | ä¿å­˜åˆ°è¡¨ |
|-----|------|---------|
| `saveGrammarMistake()` | ä¿å­˜è¯­æ³•é”™é¢˜ | `grammarMistakes` |
| `saveTransformationMistake()` | ä¿å­˜è¯è½¬é”™é¢˜ | `transformationMistakes` |
| `saveGeneralMistake()` | ä¿å­˜é€šç”¨é”™é¢˜ | `user_mistakes` |

---

## ğŸ“Š æ•°æ®æµç¨‹

### æ—§æ–¹æ¡ˆï¼ˆç»Ÿä¸€å­˜å‚¨ï¼‰

```
ä¸Šä¼ é”™é¢˜
  â†“
å…¨éƒ¨ä¿å­˜åˆ° user_mistakes è¡¨
  â†“
âŒ è¯­æ³•é¢˜æ²¡æœ‰ä¸“é—¨çš„è¡¨
âŒ è¯è½¬é¢˜æ²¡æœ‰ä¸“é—¨çš„è¡¨
âŒ æ— æ³•æŒ‰é¢˜å‹ç»Ÿè®¡å’Œåˆ†æ
```

### æ–°æ–¹æ¡ˆï¼ˆè‡ªåŠ¨åˆ†ç±»ï¼‰

```
ä¸Šä¼ é”™é¢˜
  â†“
AIè¯†åˆ«é¢˜å‹
  â†“
è‡ªåŠ¨åˆ†ç±»ä¿å­˜
  â†“
â”œâ”€ è¯­æ³•é¢˜ â†’ grammarMistakes è¡¨
â”œâ”€ è¯è½¬é¢˜ â†’ transformationMistakes è¡¨
â””â”€ å…¶ä»–é¢˜ â†’ user_mistakes è¡¨
  â†“
âœ… æ¯ä¸ªé¢˜å‹æœ‰ä¸“é—¨çš„è¡¨
âœ… å¯ä»¥æŒ‰é¢˜å‹ç»Ÿè®¡å’Œåˆ†æ
âœ… é’ˆå¯¹æ€§è®­ç»ƒæ›´æœ‰æ•ˆ
```

---

## âœ… åŠŸèƒ½ç‰¹æ€§

1. âœ… **AIæ™ºèƒ½è¯†åˆ«é¢˜å‹**ï¼ˆgrammar / word-formation / readingï¼‰
2. âœ… **è‡ªåŠ¨åˆ†ç±»åˆ°å¯¹åº”æ•°æ®åº“è¡¨**
3. âœ… **è¯­æ³•é¢˜å…³è”çŸ¥è¯†ç‚¹**
4. âœ… **è¯è½¬é¢˜æå–åŸºç¡€è¯**
5. âœ… **å»é‡æ£€æŸ¥**ï¼ˆæ¯ä¸ªè¡¨ç‹¬ç«‹å»é‡ï¼‰
6. âœ… **é”™è¯¯å¤„ç†**ï¼ˆå®Œå–„çš„é”™è¯¯æç¤ºï¼‰

---

## ğŸ’¡ ä¼˜åŠ¿

| ç‰¹æ€§ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|-----|--------|--------|
| é¢˜å‹è¯†åˆ« | âœ… AIè¯†åˆ« | âœ… AIè¯†åˆ« |
| åˆ†ç±»å­˜å‚¨ | âŒ ç»Ÿä¸€å­˜å‚¨ | âœ… è‡ªåŠ¨åˆ†ç±» |
| è¯­æ³•é¢˜ç»Ÿè®¡ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è¯è½¬é¢˜ç»Ÿè®¡ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| é’ˆå¯¹æ€§è®­ç»ƒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âœ… å®Œå…¨æ”¯æŒ |

---

## ğŸ” å»é‡æœºåˆ¶

æ¯ä¸ªé¢˜å‹éƒ½æœ‰ç‹¬ç«‹çš„å»é‡æœºåˆ¶ï¼š

| é¢˜å‹ | å»é‡å­—æ®µ | è¡¨ |
|-----|---------|-----|
| è¯­æ³•é¢˜ | userId + question | grammarMistakes |
| è¯è½¬é¢˜ | userId + sentence | transformationMistakes |
| å…¶ä»–é¢˜ | userId + question | user_mistakes |

---

## ğŸ› å·²çŸ¥é—®é¢˜

1. **è¯è½¬ç±»å‹è¯†åˆ«**
   - é—®é¢˜ï¼šè¯è½¬ç±»å‹ï¼ˆåè¯åŒ–ã€åŠ¨è¯åŒ–ç­‰ï¼‰è¯†åˆ«ä¸å‡†ç¡®
   - è§£å†³ï¼šéœ€è¦ä¼˜åŒ–AIæç¤ºè¯

2. **çŸ¥è¯†ç‚¹å…³è”**
   - é—®é¢˜ï¼šéƒ¨åˆ†è¯­æ³•é¢˜æ— æ³•å‡†ç¡®å…³è”çŸ¥è¯†ç‚¹
   - è§£å†³ï¼šæ‰‹åŠ¨è¡¥å……æˆ–ä¼˜åŒ–AIè¯†åˆ«

3. **å¤šé¢˜æ–‡ä»¶**
   - é—®é¢˜ï¼šä¸€ä¸ªæ–‡ä»¶åŒ…å«å¤šé“é¢˜æ—¶ï¼Œåªå¤„ç†ç¬¬ä¸€é“
   - è§£å†³ï¼šåç»­æ”¯æŒæ‰¹é‡è¯†åˆ«

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- APIæ–‡æ¡£ï¼š`src/app/api/mistakes/upload/route.ts`
- æ•°æ®åº“è¡¨ï¼š`src/storage/database/shared/schema.ts`

---

## âœ… éªŒæ”¶æ¸…å•

- âœ… åˆ†æå½“å‰é”™é¢˜ä¸Šä¼ æœºåˆ¶
- âœ… ä¿®æ”¹é”™é¢˜ä¸Šä¼ API
- âœ… å®ç°è‡ªåŠ¨åˆ†ç±»åŠŸèƒ½
- âœ… æ·»åŠ å»é‡æœºåˆ¶
- âœ… å®Œå–„é”™è¯¯å¤„ç†
- âœ… æ”¯æŒä¸‰ç§é¢˜å‹è¯†åˆ«

---

## ğŸ‰ æ€»ç»“

**ç­”æ¡ˆ**ï¼šâœ… **ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶åˆ†ç±»ï¼**

é”™é¢˜ä¸Šä¼ APIå·²ç»æ”¯æŒï¼š
1. âœ… AIæ™ºèƒ½è¯†åˆ«é¢˜å‹ï¼ˆè¯­æ³•é¢˜ã€è¯è½¬é¢˜ã€é˜…è¯»ç†è§£ï¼‰
2. âœ… è‡ªåŠ¨åˆ†ç±»åˆ°å¯¹åº”çš„æ•°æ®åº“è¡¨
3. âœ… é’ˆå¯¹æ€§ä¿å­˜å’Œå¤„ç†
4. âœ… ç‹¬ç«‹çš„å»é‡æœºåˆ¶

**æ•°æ®æµç¨‹**ï¼š
```
ä¸Šä¼ é”™é¢˜
  â†“
AIè¯†åˆ«é¢˜å‹
  â†“
â”œâ”€ è¯­æ³•é¢˜ â†’ grammarMistakes è¡¨
â”œâ”€ è¯è½¬é¢˜ â†’ transformationMistakes è¡¨
â””â”€ å…¶ä»–é¢˜ â†’ user_mistakes è¡¨
```

æ— éœ€æ‰‹åŠ¨åˆ†ç±»ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ğŸš€
