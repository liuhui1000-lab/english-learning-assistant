# 向下兼容逻辑测试说明

## 测试目的

验证学习内容适配器的向下兼容逻辑是否正确：
- 年级映射是否正确
- 学习统计计算是否准确
- 学习计划生成是否合理

## 运行测试

### 方法1：使用 Node.js 运行

```bash
cd /workspace/projects
npx ts-node src/storage/database/test-downward-compatibility.ts
```

### 方法2：编译后运行

```bash
cd /workspace/projects
npx tsc src/storage/database/test-downward-compatibility.ts --outDir dist
node dist/test-downward-compatibility.js
```

## 测试内容

### 1. 年级映射测试

测试不同年级的学生可以访问哪些年级的内容：

| 学生年级 | 可访问年级 | 预期结果 |
|---------|----------|---------|
| 6年级 | 6年级 | ✅ 只能访问6年级 |
| 7年级 | 6年级、7年级 | ✅ 可访问6、7年级 |
| 8年级 | 6年级、7年级、8年级 | ✅ 可访问6、7、8年级 |
| 9年级 | 6年级、7年级、8年级、9年级 | ✅ 可访问6、7、8、9年级 |

### 2. 学习统计测试

测试不同年级学生的学习统计数据：

**模拟数据**：
- happy 词族：happy(8年级)、happiness(7年级)、happily(6年级)、unhappy(9年级)
- success 词族：success(7年级)、successful(6年级)、successfully(8年级)

**预期结果**：

| 学生年级 | 可访问年级 | 总单词数 | 新学单词 | 复习单词 |
|---------|----------|---------|---------|---------|
| 6年级 | 6年级 | 2 | 2 | 0 |
| 7年级 | 6年级、7年级 | 5 | 2 | 3 |
| 8年级 | 6年级、7年级、8年级 | 6 | 2 | 4 |
| 9年级 | 6年级、7年级、8年级、9年级 | 7 | 1 | 6 |

### 3. 学习计划测试

测试不同年级学生的学习计划：

**模拟数据**：
- 6年级：3个词族
- 7年级：2个词族
- 8年级：2个词族
- 9年级：1个词族

**预期结果**：

| 学生年级 | 学习计划 | 词族数 | 预计天数 |
|---------|---------|-------|---------|
| 6年级 | 新学内容：6年级 | 3 | 1 |
| 7年级 | 复习：6年级<br/>新学：7年级 | 3 + 2 = 5 | 1 + 1 = 2 |
| 8年级 | 复习：6年级、7年级<br/>新学：8年级 | 3 + 2 + 2 = 7 | 1 + 1 + 1 = 3 |
| 9年级 | 复习：6年级、7年级、8年级<br/>新学：9年级 | 3 + 2 + 2 + 1 = 8 | 1 + 1 + 1 + 1 = 4 |

## API 测试

除了脚本测试，还可以通过 API 测试向下兼容逻辑：

### 1. 测试获取学习内容

```bash
# 8年级学生获取学习内容
curl "http://localhost:5000/api/learning/content?grade=8年级&limit=10"

# 7年级学生获取学习内容
curl "http://localhost:5000/api/learning/content?grade=7年级&limit=10"
```

### 2. 测试获取学习统计

```bash
# 8年级学生的学习统计
curl "http://localhost:5000/api/learning/stats?grade=8年级"

# 7年级学生的学习统计
curl "http://localhost:5000/api/learning/stats?grade=7年级"
```

### 3. 测试生成学习计划

```bash
# 8年级学生的学习计划
curl "http://localhost:5000/api/learning/plan?grade=8年级"

# 7年级学生的学习计划
curl "http://localhost:5000/api/learning/plan?grade=7年级"
```

### 4. 测试向下兼容逻辑（需要管理员权限）

```bash
curl "http://localhost:5000/api/learning/test-compatibility"
```

## 预期输出示例

### 年级映射测试输出

```
=== 测试年级向下兼容映射 ===

学生年级: 6年级
可访问年级: 6年级
总年级数: 1
---
学生年级: 7年级
可访问年级: 6年级, 7年级
总年级数: 2
---
学生年级: 8年级
可访问年级: 6年级, 7年级, 8年级
总年级数: 3
---
学生年级: 9年级
可访问年级: 6年级, 7年级, 8年级, 9年级
总年级数: 4
---
```

### 学习统计测试输出

```
=== 测试学习统计计算 ===

学生年级: 6年级
可访问年级: 6年级
总单词数: 2
当前年级单词数（新学）: 2
复习单词数: 0
---
学生年级: 7年级
可访问年级: 6年级, 7年级
总单词数: 5
当前年级单词数（新学）: 2
复习单词数: 3
---
学生年级: 8年级
可访问年级: 6年级, 7年级, 8年级
总单词数: 6
当前年级单词数（新学）: 2
复习单词数: 4
---
学生年级: 9年级
可访问年级: 6年级, 7年级, 8年级, 9年级
总单词数: 7
当前年级单词数（新学）: 1
复习单词数: 6
---
```

### 学习计划测试输出

```
=== 测试学习计划生成 ===

学生年级: 6年级
  新学内容: 6年级 - 3个词族 (1天)
推荐词族总数: 3
---
学生年级: 7年级
  复习内容: 6年级 - 3个词族 (1天)
  新学内容: 7年级 - 2个词族 (1天)
推荐词族总数: 5
---
学生年级: 8年级
  复习内容: 6年级 - 3个词族 (1天)
  复习内容: 7年级 - 2个词族 (1天)
  新学内容: 8年级 - 2个词族 (1天)
推荐词族总数: 7
---
学生年级: 9年级
  复习内容: 6年级 - 3个词族 (1天)
  复习内容: 7年级 - 2个词族 (1天)
  复习内容: 8年级 - 2个词族 (1天)
  新学内容: 9年级 - 1个词族 (1天)
推荐词族总数: 8
---
```

## 验证标准

### ✅ 通过标准

1. 年级映射正确
2. 学习统计计算准确
3. 学习计划生成合理
4. 高年级学生可以访问低年级内容
5. 低年级学生无法访问高年级内容

### ❌ 失败标准

1. 年级映射错误
2. 学习统计计算错误
3. 学习计划生成不合理
4. 高年级学生无法访问低年级内容
5. 低年级学生可以访问高年级内容

## 相关文档

- [学习内容向下兼容设计](../docs/learning-content-downward-compatibility.md)
- [词族系统快速开始](../docs/word-family-quick-start.md)
- [压缩摘要](../docs/compressed-summary.md)
